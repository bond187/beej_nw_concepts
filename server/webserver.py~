import sys
import socket

if len(sys.argv) > 1:
    PORT = int(sys.argv[1])
else:
    PORT = 28333

bind_tuple = ('', PORT)

print("Server initializing...")
print("Listening on port: {}".format(PORT))

try:
    s = socket.socket()
    s.bind(bind_tuple)
    s.listen()
    while(True):
        conn, addr = s.accept()
        print(f"Connected by {addr}")
        while(True):
            data = conn.recv(1024)
            if len(data) != 0:
                print("Data recieved:\n{}".format(data.decode("ISO-8859-1")))
            else:
                print("Everything received!!")
                conn.sendall("HTTP/1.1 200 OK\r\nContent-Type: text/plain\r\nContent-Length: 6\r\nConnection: close\r\n\r\nHello!")
                break
        conn.close()
    print("Connection closed.")
except KeyboardInterrupt:
    print("\nShutting down... goodbye <3")
